<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Untitled Document</title></head>

<body>
<p align="center"><strong>HIMSS and RSNA</strong><br />
    <strong>Integrating the Healthcare Enterprise</strong></p>
<p align="center"><strong>&nbsp;</strong></p>
<p align="center"><strong>&nbsp;</strong><strong>Kerberos Notes</strong></p>
<p>&nbsp;</p>
<p align="center">Electronic Radiology  Laboratory<br />
  Mallinckrodt Institute of  Radiology<br />
  510 South    Kingshighway Blvd. <br />
  St. Louis, MO&nbsp; 63110 <br />
  314.362.6965 (Voice)<br />
  314.362.6971 (Fax)</p>
<p align="center">&nbsp;</p>
<p align="center">Revision 7.3.0<br />
  November 11, 2003 </p>
<strong>Contents:</strong><br clear="all" />

  <p><a href="#intro">Introduction</a> <br />
      <a href="#config_windows">Configuration of Windows 2000 Server as Kerberos  Authentication Server</a> <br />
<a href="#config_redhat">Configuration of RedHat 9 Linux Workstation as  Kerberos Authentication Client </a> </p>




  <h1><a name="#intro" id="#intro">Introduction</a> </h1>
  <p>This document provides  notes about Kerberos software, servers, installation, and any other information  we can think to provide. Some of the notes include references to systems  installed at Washington   University. That is done  both as a reminder to us and to provide concrete examples.</p>
  <h1><a name="#config_windows" id="#config_windows">Configuration  of Windows 2000 Server as Kerberos Authentication Server</a> </h1>

  <ol>
    <li>Install  Active Directory (which also installs DNS).</li>
    <li>Configure  a domain name as this sytem will act as a domain controller. <em>(The domain  name chosen for the WU private network is WUSTL.EDU.)</em></li>
    <li>Configure  DNS for forward and rever lookup zones. For convenience, a pointer record is  added to the reverse lookup zone for this system (which is now a DNS server). <em>(At  WU, we also added an entry for the Linux host used in our experiments.)</em></li>
    <li>Use  the Active Directory service management tool to create an Organizational Unit  called &quot;Accounts&quot;.&nbsp; The  &quot;Accounts&quot; Organizational Unit&nbsp;  is under &quot;Active Directory Users and Computers | wustl.edu&quot;.</li>
    <li>In  the &quot;Accounts&quot; Organizational Unit, add a user. The test plans call  for the name <em>khimss</em>.</li>
    <li>The  Kerberos configuration utilities are in C:\Program Files\Support Tools. Run the  ktpass program to create a keytab file on the Windows 2000 server.&nbsp; (This keytab file will be copied over to the  Linux host, and merged with <em>/etc/krb5.keytab</em>).&nbsp; The ktpass command was used to create a  keytab file and set the password. In the example below, the host name is ihe-2.</li>
  </ol>
  <pre>    C:\Program  Files\Support Tools&gt;ktpass -princ host/ihe-2.wustl.edu@WUSTL.EDU -mapuser  ihe-2 -pass 1234AaBb -out 
    C:\ihe-2.keytab
    Successfully  mapped host/ihe-2.wustl.edu to ihe-2.
    Key  created.
    Output  keytab to C:\ihe-2.keytab:
    Keytab  version: 0x502
    keysize  57 host/ihe-2.wustl.edu@WUSTL.EDU ptype 1 (KRB5_NT_PRINCIPAL) vno 1 etyp e 0x1  (DES-CBC-CRC) 
    keylength 8 (0xb50b084c2f764080)
    Account  has been set for DES-only encryption.</pre>
  <p>The steps above allowed us to create an ihe-2 account and  a keytab file with that information. At a later time, we created the khimss  account and did not regenerate the keytab file. The Linux system was able to  authenticate the khimss acount without installation of a new keytab file.</p>
 
  <h1><a name="#config_redhat" id="#config_redhat">Configuration  of RedHat 9 Linux Workstation as Kerberos Authentication Client</a> </h1>
  <ol>
    <li>Install  from the RedHat CDs and use the &ldquo;custom&rdquo; configuration option. (You can always  configure after the fact if you miss this step.)&nbsp; During the&nbsp;  installation, the authentication configuration should include shadow  passwords,&nbsp; md5 passwords; and must  include Kerberos 5 to authenticate using the Windows 2000 server.&nbsp; For Kerberos to work, we also need to specify  the Realm, KDC,&nbsp; and Admin Server.</li>
    <li>The  Realm is whatever the Active Directory domain was configured to be, except in  uppercase. In the example below, the hostnames are registered with a DNS server  that is not the KDC/Kerberos Authentication Server.</li>
  </ol>
  <pre>    Realm:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WUSTL.EDU 
    KDC:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ihe-3.wustl.edu:88
    Admin  Server:  ihe-3.wustl.edu:749</pre>
  <ol start="3">
    <li>Copy  the keytab file created on the Kerberos Authentication Server and install on  this system. These steps were performed as root using the keytab file <em>ihe-2.keytab</em>:</li>
  </ol>
  <pre>    unix-prompt&gt; # ktutil
    ktutil:&nbsp; rkt ihe-2.keytab
    ktutil:&nbsp; list
    slot KVNO Principal
    ---- ----  ---------------------------------------------------------------------
    &nbsp;&nbsp; 1&nbsp;&nbsp;&nbsp;  1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  host/ihe-2.wustl.edu@WUSTL.EDU
    ktutil:&nbsp; wkt /etc/krb5.keytab
    ktutil:&nbsp; q </pre>
  <ol start="4">
    <li>Add  a user on the local unix box. This should be the same user that was added on  the Kerberos Authentication Server. Lock the password entry on the local unix  system. This should force the system to use the Kerberos Authentication Server.</li>
    <li>Logon  to the Unix system using the account created (khimss).</li>
    <li>Run  the command klist to list Kerberos tickets.</li>
    <li>Logoff  and disconnect the network adapter. Try to login again using the account  created. This step should fail because you no longer have a connection to the  Kerberos Authentication Server.</li>
  </ol>
  <p>&nbsp;</p>

</body>
</html>
